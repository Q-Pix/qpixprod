from __future__ import print_function

import sys
import argparse

import numpy as np

import isotro as isotropic

# parse arguments from command
parser = argparse.ArgumentParser(description="Generate MARLEY configuration")
parser.add_argument("--neutrino", type=str, default="ve", help="neutrino")
parser.add_argument("--reaction", type=str, default="es", help="reaction")
parser.add_argument("--seed", type=int, default=None,
                    help='integer seed for RNG')

args = parser.parse_args()
neutrino = args.neutrino
reaction = args.reaction
seed = args.seed

neutrinos = [ "ve", "vebar", "vu", "vubar", "vt", "vtbar" ]

reactions = {
    "cc" : "ve40ArCC_Bhattacharya2009.react",
    "es" : "ES.react",
}

# check if neutrino is valid
if neutrino not in neutrinos:
    msg = """Neutrino '{}' is not valid!
Valid neutrinos:
{}""".format(neutrino, neutrinos)
    raise ValueError(msg)

# check if reaction is valid
if reaction not in reactions.keys():
    msg = """Reaction '{}' is not valid!
Valid reactions:
{}""".format(reaction, list(reactions.keys()))
    raise ValueError(msg)

# check if cc reaction has ve neutrino
if reaction == "cc" and neutrino != "ve":
    msg = """Neutrino '{}' is not valid for reaction '{}'.
MARLEY can only handle 've' neutrinos in 'cc' reactions.
""".format(neutrino, reaction)
    raise ValueError(msg)

# if not args.seed:
#     seed = 137

x, y, z = isotropic.sample(1, seed=seed)

react = reactions[reaction]

cfg = """
{{
  seed: 123456, // Random number seed (omit to use time since Unix epoch)

  // reaction matrix element files
  reactions: [ "{}" ],

  // neutrino source specification
  source: {{
    type: "histogram",
    neutrino: "{}",

    // low edges of energy bins (MeV)
    E_bin_lefts: [
        0.1,  0.3,  0.5,  0.7,  0.9,  1.1,  1.3,  1.5,  1.7,  1.9,  2.1,
        2.3,  2.5,  2.7,  2.9,  3.1,  3.3,  3.5,  3.7,  3.9,  4.1,  4.3,
        4.5,  4.7,  4.9,  5.1,  5.3,  5.5,  5.7,  5.9,  6.1,  6.3,  6.5,
        6.7,  6.9,  7.1,  7.3,  7.5,  7.7,  7.9,  8.1,  8.3,  8.5,  8.7,
        8.9,  9.1,  9.3,  9.5,  9.7,  9.9, 10.1, 10.3, 10.5, 10.7, 10.9,
       11.1, 11.3, 11.5, 11.7, 11.9, 12.1, 12.3, 12.5, 12.7, 12.9, 13.1,
       13.3, 13.5, 13.7, 13.9, 14.1, 14.3, 14.5, 14.7, 14.9, 15.1, 15.3,
       15.5, 15.7, 15.9, 16.1, 16.3, 16.5, 16.7, 16.9, 17.1, 17.3, 17.5,
       17.7, 17.9, 18.1, 18.3, 18.5, 18.7, 18.9, 19.1, 19.3, 19.5, 19.7,
       19.9, 20.1, 20.3, 20.5, 20.7, 20.9, 21.1, 21.3, 21.5, 21.7, 21.9,
       22.1, 22.3, 22.5, 22.7, 22.9, 23.1, 23.3, 23.5, 23.7, 23.9, 24.1,
       24.3, 24.5, 24.7, 24.9, 25.1, 25.3, 25.5, 25.7, 25.9, 26.1, 26.3,
       26.5, 26.7, 26.9, 27.1, 27.3, 27.5, 27.7, 27.9, 28.1, 28.3, 28.5,
       28.7, 28.9, 29.1, 29.3, 29.5, 29.7, 29.9, 30.1, 30.3, 30.5, 30.7,
       30.9, 31.1, 31.3, 31.5, 31.7, 31.9, 32.1, 32.3, 32.5, 32.7, 32.9,
       33.1, 33.3, 33.5, 33.7, 33.9, 34.1, 34.3, 34.5, 34.7, 34.9, 35.1,
       35.3, 35.5, 35.7, 35.9, 36.1, 36.3, 36.5, 36.7, 36.9, 37.1, 37.3,
       37.5, 37.7, 37.9, 38.1, 38.3, 38.5, 38.7, 38.9, 39.1, 39.3, 39.5,
       39.7, 39.9, 40.1, 40.3, 40.5, 40.7, 40.9, 41.1, 41.3, 41.5, 41.7,
       41.9, 42.1, 42.3, 42.5, 42.7, 42.9, 43.1, 43.3, 43.5, 43.7, 43.9,
       44.1, 44.3, 44.5, 44.7, 44.9, 45.1, 45.3, 45.5, 45.7, 45.9, 46.1,
       46.3, 46.5, 46.7, 46.9, 47.1, 47.3, 47.5, 47.7, 47.9, 48.1, 48.3,
       48.5, 48.7, 48.9, 49.1, 49.3, 49.5, 49.7, 49.9, 50.1, 50.3, 50.5,
       50.7, 50.9, 51.1, 51.3, 51.5, 51.7, 51.9, 52.1, 52.3, 52.5, 52.7,
       52.9, 53.1, 53.3, 53.5, 53.7, 53.9, 54.1, 54.3, 54.5, 54.7, 54.9,
       55.1, 55.3, 55.5, 55.7, 55.9, 56.1, 56.3, 56.5, 56.7, 56.9, 57.1,
       57.3, 57.5, 57.7, 57.9, 58.1, 58.3, 58.5, 58.7, 58.9, 59.1, 59.3,
       59.5, 59.7, 59.9, 60.1, 60.3, 60.5, 60.7, 60.9, 61.1, 61.3, 61.5,
       61.7, 61.9, 62.1, 62.3, 62.5, 62.7, 62.9, 63.1, 63.3, 63.5, 63.7,
       63.9, 64.1, 64.3, 64.5, 64.7, 64.9, 65.1, 65.3, 65.5, 65.7, 65.9,
       66.1, 66.3, 66.5, 66.7, 66.9, 67.1, 67.3, 67.5, 67.7, 67.9, 68.1,
       68.3, 68.5, 68.7, 68.9, 69.1, 69.3, 69.5, 69.7, 69.9, 70.1, 70.3,
       70.5, 70.7, 70.9, 71.1, 71.3, 71.5, 71.7, 71.9, 72.1, 72.3, 72.5,
       72.7, 72.9, 73.1, 73.3, 73.5, 73.7, 73.9, 74.1, 74.3, 74.5, 74.7,
       74.9, 75.1, 75.3, 75.5, 75.7, 75.9, 76.1, 76.3, 76.5, 76.7, 76.9,
       77.1, 77.3, 77.5, 77.7, 77.9, 78.1, 78.3, 78.5, 78.7, 78.9, 79.1,
       79.3, 79.5, 79.7, 79.9, 80.1, 80.3, 80.5, 80.7, 80.9, 81.1, 81.3,
       81.5, 81.7, 81.9, 82.1, 82.3, 82.5, 82.7, 82.9, 83.1, 83.3, 83.5,
       83.7, 83.9, 84.1, 84.3, 84.5, 84.7, 84.9, 85.1, 85.3, 85.5, 85.7,
       85.9, 86.1, 86.3, 86.5, 86.7, 86.9, 87.1, 87.3, 87.5, 87.7, 87.9,
       88.1, 88.3, 88.5, 88.7, 88.9, 89.1, 89.3, 89.5, 89.7, 89.9, 90.1,
       90.3, 90.5, 90.7, 90.9, 91.1, 91.3, 91.5, 91.7, 91.9, 92.1, 92.3,
       92.5, 92.7, 92.9, 93.1, 93.3, 93.5, 93.7, 93.9, 94.1, 94.3, 94.5,
       94.7, 94.9, 95.1, 95.3, 95.5, 95.7, 95.9, 96.1, 96.3, 96.5, 96.7,
       96.9, 97.1, 97.3, 97.5, 97.7, 97.9, 98.1, 98.3, 98.5, 98.7, 98.9,
       99.1, 99.3, 99.5, 99.7, 99.9
    ],

    // bin weights (dimensionless)
    weights: [
       1.108371780e06, 7.979004000e06, 2.478971960e07, 5.442318380e07,
       9.866527670e07, 1.583848140e08, 2.336965260e08, 3.241070420e08,
       4.286446500e08, 5.459736560e08, 6.744947090e08, 8.124311900e08,
       9.579038140e08, 1.108993190e09, 1.263792510e09, 1.420449080e09,
       1.577199040e09, 1.732392960e09, 1.884514970e09, 2.032195510e09,
       2.174220130e09, 2.309530970e09, 2.437229370e09, 2.556569160e09,
       2.666954780e09, 2.767930290e09, 2.859172100e09, 2.940479560e09,
       3.011762850e09, 3.073032800e09, 3.124391170e09, 3.166016570e09,
       3.198158510e09, 3.221122960e09, 3.235265830e09, 3.240982150e09,
       3.238699520e09, 3.228868590e09, 3.211957860e09, 3.188446270e09,
       3.158818240e09, 3.123558950e09, 3.083148700e09, 3.038062390e09,
       2.988761830e09, 2.935696600e09, 2.879301170e09, 2.819992040e09,
       2.758167580e09, 2.694206350e09, 2.628466350e09, 2.561285360e09,
       2.492979410e09, 2.423844360e09, 2.354154780e09, 2.284164760e09,
       2.214108850e09, 2.144201440e09, 2.074639330e09, 2.005600300e09,
       1.937244720e09, 1.869717580e09, 1.803147300e09, 1.737647640e09,
       1.673319620e09, 1.610249380e09, 1.548511510e09, 1.488170310e09,
       1.429278110e09, 1.371878000e09, 1.316004360e09, 1.261682210e09,
       1.208930140e09, 1.157759170e09, 1.108173830e09, 1.060173350e09,
       1.013751600e09, 9.688977620e08, 9.255967780e08, 8.838301970e08,
       8.435762430e08, 8.048101460e08, 7.675044930e08, 7.316301020e08,
       6.971559520e08, 6.640494290e08, 6.322768160e08, 6.018026740e08,
       5.725920280e08, 5.446082470e08, 5.178150740e08, 4.921754110e08,
       4.676526410e08, 4.442099680e08, 4.218108440e08, 4.004189640e08,
       3.799985250e08, 3.605142030e08, 3.419311680e08, 3.242152110e08,
       3.073329370e08, 2.912515010e08, 2.759389480e08, 2.613640040e08,
       2.474963850e08, 2.343064770e08, 2.217655560e08, 2.098458130e08,
       1.985203090e08, 1.877629070e08, 1.775484350e08, 1.678524580e08,
       1.586515040e08, 1.499229030e08, 1.416447900e08, 1.337962450e08,
       1.263569840e08, 1.193075920e08, 1.126294340e08, 1.063046430e08,
       1.003160670e08, 9.464720760e07, 8.928236290e07, 8.420646220e07,
       7.940503890e07, 7.486437600e07, 7.057120120e07, 6.651302960e07,
       6.267776920e07, 5.905399830e07, 5.563074760e07, 5.239762860e07,
       4.934468140e07, 4.646245100e07, 4.374193150e07, 4.117453740e07,
       3.875212420e07, 3.646692350e07, 3.431157440e07, 3.227905480e07,
       3.036270650e07, 2.855621020e07, 2.685355520e07, 2.524905170e07,
       2.373729220e07, 2.231315000e07, 2.097176410e07, 1.970852770e07,
       1.851907330e07, 1.739926460e07, 1.634518500e07, 1.535311990e07,
       1.441956830e07, 1.354119870e07, 1.271486940e07, 1.193761070e07,
       1.120660690e07, 1.051919850e07, 9.872876380e06, 9.265264560e06,
       8.694119140e06, 8.157322250e06, 7.652868670e06, 7.178876000e06,
       6.733555190e06, 6.315227540e06, 5.922298460e06, 5.553274940e06,
       5.206741870e06, 4.881365460e06, 4.575891320e06, 4.289131450e06,
       4.019973060e06, 3.767361140e06, 3.530303680e06, 3.307868730e06,
       3.099175060e06, 2.903396200e06, 2.719749940e06, 2.547503830e06,
       2.385964470e06, 2.234482980e06, 2.092446340e06, 1.959279180e06,
       1.834439110e06, 1.717416900e06, 1.607733260e06, 1.504937320e06,
       1.408605410e06, 1.318339190e06, 1.233764660e06, 1.154529450e06,
       1.080303320e06, 1.010775450e06, 9.456539790e05, 8.846648680e05,
       8.275508490e05, 7.740696830e05, 7.239946080e05, 6.771126600e05,
       6.332235680e05, 5.921392180e05, 5.536838340e05, 5.176918020e05,
       4.840079850e05, 4.524864560e05, 4.229906450e05, 3.953928700e05,
       3.695723910e05, 3.454166720e05, 3.228200350e05, 3.016833550e05,
       2.819133870e05, 2.634235130e05, 2.461318500e05, 2.299616300e05,
       2.148413490e05, 2.007037720e05, 1.874858420e05, 1.751285810e05,
       1.635766660e05, 1.527783230e05, 1.426850140e05, 1.332513010e05,
       1.244346040e05, 1.161951430e05, 1.084954940e05, 1.013007640e05,
       9.457826830e04, 8.829736340e04, 8.242938920e04, 7.694748780e04,
       7.182659530e04, 6.704317020e04, 6.257524810e04, 5.840223860e04,
       5.450488770e04, 5.086518000e04, 4.746629650e04, 4.429244930e04,
       4.132890910e04, 3.856187960e04, 3.597843590e04, 3.356658800e04,
       3.131497930e04, 2.921313660e04, 2.725113610e04, 2.541981990e04,
       2.371053160e04, 2.211522920e04, 2.062637190e04, 1.923694950e04,
       1.794035250e04, 1.673047010e04, 1.560152940e04, 1.454817190e04,
       1.356538170e04, 1.264847490e04, 1.179307330e04, 1.099508400e04,
       1.025068980e04, 9.556322030e03, 8.908643780e03, 8.304544930e03,
       7.741115890e03, 7.215636610e03, 6.725580220e03, 6.268571420e03,
       5.842403700e03, 5.445009830e03, 5.074461410e03, 4.728959630e03,
       4.406823090e03, 4.106485730e03, 3.826483350e03, 3.565449950e03,
       3.322105990e03, 3.095265910e03, 2.883815830e03, 2.686720030e03,
       2.503011660e03, 2.331784730e03, 2.172202020e03, 2.023472860e03,
       1.884865460e03, 1.755696460e03, 1.635326180e03, 1.523160300e03,
       1.418643210e03, 1.321256300e03, 1.230516470e03, 1.145972820e03,
       1.067205020e03, 9.938210410e02, 9.254550760e02, 8.617662190e02,
       8.024364350e02, 7.471693790e02, 6.956880310e02, 6.477351690e02,
       6.030699330e02, 5.614686370e02, 5.227219370e02, 4.866354830e02,
       4.530274530e02, 4.217288050e02, 3.925814650e02, 3.654384950e02,
       3.401629830e02, 3.166270330e02, 2.947114000e02, 2.743054430e02,
       2.553056840e02, 2.376153690e02, 2.211453330e02, 2.058113100e02,
       1.915356380e02, 1.782454790e02, 1.658733490e02, 1.543560190e02,
       1.436348620e02, 1.336549020e02, 1.243652940e02, 1.157184750e02,
       1.076702260e02, 1.001792780e02, 9.320722660e01, 8.671831910e01,
       8.067923110e01, 7.505889510e01, 6.982846430e01, 6.496095680e01,
       6.043135960e01, 5.621629190e01, 5.229402760e01, 4.864429730e01,
       4.524826620e01, 4.208836180e01, 3.914826550e01, 3.641272930e01,
       3.386758590e01, 3.149966160e01, 2.929664130e01, 2.724712000e01,
       2.534042290e01, 2.356663580e01, 2.191655410e01, 2.038155390e01,
       1.895368140e01, 1.762547160e01, 1.638998410e01, 1.524080510e01,
       1.417189420e01, 1.317769240e01, 1.225297170e01, 1.139292000e01,
       1.059302750e01, 9.849094600e00, 9.157225620e00, 8.513790640e00,
       7.915409310e00, 7.358943860e00, 6.841465720e00, 6.360252470e00,
       5.912774080e00, 5.496673390e00, 5.109758760e00, 4.749989280e00,
       4.415469910e00, 4.104430300e00, 3.815233340e00, 3.546347790e00,
       3.296349920e00, 3.063920890e00, 2.847829640e00, 2.646931730e00,
       2.460160710e00, 2.286528110e00, 2.125113290e00, 1.975058350e00,
       1.835566570e00, 1.705897630e00, 1.585361520e00, 1.473316400e00,
       1.369167270e00, 1.272357350e00, 1.182375340e00, 1.098736520e00,
       1.020997850e00, 9.48743296e-01, 8.81587615e-01, 8.19172080e-01,
       7.61162840e-01, 7.07250338e-01, 6.57145687e-01, 6.10580895e-01,
       5.67306611e-01, 5.27090830e-01, 4.89718224e-01, 4.54988402e-01,
       4.22715066e-01, 3.92724675e-01, 3.64856370e-01, 3.38960546e-01,
       3.14897776e-01, 2.92538568e-01, 2.71763294e-01, 2.52459479e-01,
       2.34523093e-01, 2.17857936e-01, 2.02374020e-01, 1.87987773e-01,
       1.74621673e-01, 1.62203771e-01, 1.50666410e-01, 1.39947888e-01,
       1.29989905e-01, 1.20738859e-01, 1.12144555e-01, 1.04160515e-01,
       9.67434803e-02, 8.98534487e-02, 8.34529072e-02, 7.75072268e-02,
       7.19841729e-02, 6.68537497e-02, 6.20881207e-02, 5.76614542e-02,
       5.35496566e-02, 4.97304086e-02, 4.61829216e-02, 4.28879232e-02,
       3.98275148e-02, 3.69849746e-02, 3.43448774e-02, 3.18928100e-02,
       2.96154260e-02, 2.75003071e-02, 2.55359423e-02, 2.37115766e-02,
       2.20172697e-02, 2.04437624e-02, 1.89824810e-02, 1.76254294e-02,
       1.63651820e-02, 1.51948510e-02, 1.41080512e-02, 1.30988233e-02,
       1.21616355e-02, 1.12913633e-02, 1.04832554e-02, 9.73284466e-03,
       9.03605484e-03, 8.38904088e-03, 7.78826634e-03, 7.23043021e-03,
       6.71246985e-03, 6.23154158e-03, 5.78500178e-03, 5.37040113e-03,
       4.98545324e-03, 4.62804555e-03, 4.29621209e-03, 3.98812566e-03,
       3.70209155e-03, 3.43653118e-03, 3.18998649e-03, 2.96109560e-03,
       2.74859835e-03, 2.55132041e-03, 2.36817747e-03, 2.19815553e-03,
       2.04032049e-03, 1.89379519e-03, 1.75777574e-03, 1.63150634e-03,
       1.51429348e-03, 1.40548435e-03, 1.30448143e-03, 1.21072238e-03,
       1.12369189e-03, 1.04290577e-03, 9.67918402e-04, 8.98312737e-04,
       8.33703995e-04, 7.73734100e-04, 7.18070687e-04, 6.66405075e-04,
       6.18450364e-04, 5.73940762e-04, 5.32629214e-04, 4.94286049e-04,
       4.58698805e-04, 4.25669298e-04, 3.95014497e-04, 3.66563648e-04,
       3.40158537e-04, 3.15652510e-04, 2.92908914e-04, 5.43603019e-04
    ],

    // upper edge of the final bin (MeV)
    Emax: 100.,
  }},

  // incident neutrino direction 3-vector
  direction: {{ x: {}, y: {}, z: {} }},

}}
"""

print(cfg.format(react, neutrino, x[0], y[0], z[0]))
